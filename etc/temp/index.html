<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plain JS Excalidraw Render (Fixed)</title>
    
    <!-- Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@excalidraw/excalidraw@0.17.6/dist/excalidraw.production.min.js" defer></script>
    
    <!-- Excalidraw Modules -->
    <script src="lz-string-decompressor.js"></script>
    <script src="excalidraw-renderer.js"></script>
    <script src="excalidraw-embed.js"></script>

    <style>
        #excalidraw-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <h1>Excalidraw Renderer - Static Data & Obsidian Files</h1>

    <div style="margin-bottom: 20px;">
        <label for="file-input" style="display: block; margin-bottom: 10px; font-weight: bold;">
            Load Obsidian Excalidraw File (.excalidraw.md):
        </label>
        <input type="file" id="file-input" accept=".md,.excalidraw.md" style="margin-bottom: 10px;">
        <button id="load-sample" style="margin-left: 10px; padding: 5px 10px;">Load Sample Data</button>
        <button id="load-excali-md" style="margin-left: 10px; padding: 5px 10px;">Load excali-md.md</button>
        <div id="file-status" style="margin-top: 10px; font-style: italic; color: #666;"></div>
    </div>

    <div id="excalidraw-container"></div>

    <script>
        // Clean, modular application using the ExcalidrawRenderer
        window.addEventListener("load", () => {
            console.log('üöÄ Initializing Excalidraw application');
            
            // Initialize renderer
            const renderer = new window.ExcalidrawRenderer({
                theme: 'light',
                viewModeEnabled: true,
                zenModeEnabled: false,
                gridModeEnabled: false
            });
            
            // Get UI elements
            const fileInput = document.getElementById("file-input");
            const loadSampleButton = document.getElementById("load-sample");
            const loadExcaliMdButton = document.getElementById("load-excali-md");
            const fileStatus = document.getElementById("file-status");
            const containerId = "excalidraw-container";
            
            // File upload handler
            fileInput.addEventListener("change", async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    fileStatus.textContent = "üìñ Processing file...";
                    await renderer.renderFromFile(file, containerId);
                    fileStatus.textContent = `‚úÖ Loaded: ${file.name}`;
                } catch (error) {
                    fileStatus.textContent = `‚ùå Error: ${error.message}`;
                }
            });
            
            // Load excali-md.md button
            loadExcaliMdButton.addEventListener("click", async () => {
                try {
                    fileStatus.textContent = "üìñ Loading excali-md.md...";
                    await renderer.renderFromUrl('./excali-md.md', containerId);
                    fileStatus.textContent = "‚úÖ Loaded excali-md.md successfully";
                } catch (error) {
                    fileStatus.textContent = `‚ùå Error: ${error.message}`;
                }
            });
            
            // Sample data button
            loadSampleButton.addEventListener("click", () => {
                try {
                    fileStatus.textContent = "üìä Loading sample data...";
                    renderer.render(sampleExcalidrawData, containerId);
                    fileStatus.textContent = "‚úÖ Sample data loaded";
                } catch (error) {
                    fileStatus.textContent = `‚ùå Error: ${error.message}`;
                }
            });
            
            // Sample data for testing
            const sampleExcalidrawData = {
                type: "excalidraw",
                version: 2,
                source: "https://example.com",
                elements: [
                    {
                        "id": "rect1", "type": "rectangle", "x": 240, "y": 140, "width": 180, "height": 75,
                        "strokeColor": "#1e1e1e", "backgroundColor": "#ffffff", "strokeWidth": 2,
                        "text": "Get JSON Data", "fontSize": 16, "isDeleted": false
                    },
                    {
                        "id": "ellipse1", "type": "ellipse", "x": 250, "y": 300, "width": 160, "height": 90,
                        "strokeColor": "#1e1e1e", "backgroundColor": "#ffffff", "strokeWidth": 2,
                        "text": "Render Canvas", "fontSize": 16, "isDeleted": false
                    },
                    {
                        "id": "arrow1", "type": "arrow", "x": 330, "y": 215, "width": 0, "height": 85,
                        "strokeColor": "#1e1e1e", "strokeWidth": 2, "points": [[0, 0], [0, 85]],
                        "endArrowhead": "arrow", "isDeleted": false
                    }
                ],
                appState: { "viewBackgroundColor": "#FFFFFF", "gridSize": null }
            };
            
            // Initial instructions
            fileStatus.textContent = "üëÜ Upload an .excalidraw.md file or click 'Load Sample Data' to get started";
        });
    </script>

</body>
</html>